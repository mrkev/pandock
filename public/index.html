<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>Document</title>
  <style>
  .ace {
      position: absolute;
      width: 500px;
      height: 400px;
  }
  </style>
</head>
<body>
  
  <h1>Pandoc is halla aweosme!!</h1>
  
  <h3>Write markdown here</h3>
  <div id='editor' class='ace'>An h1 header
============

Paragraphs are separated by a blank line.

2nd paragraph. *Italic*, **bold**, and `monospace`. Itemized lists
look like:

  * this one
  * that one
  * the other one

> Block quotes are
> written like so.
>
> They can span multiple paragraphs,
> if you like.

Use 3 dashes for an em-dash. Use 2 dashes for ranges (ex., "it's all
in chapters 12--14"). Three dots ... will be converted to an ellipsis.
Unicode is supported. â˜º

An h2 header
------------

Here's a numbered list:

 1. first item
 2. second item
 3. third item

Note again how the actual text starts at 4 columns in (4 characters
from the left side). Here's a code sample:

    # Let me re-iterate ...
    for i in 1 .. 10 { do-something(i) }

As you probably guessed, indented 4 spaces. By the way, instead of
indenting the block, you can use delimited blocks, if you like:

~~~
define foobar() {
    print "Welcome to flavor country!";
}
~~~

~~~python
import time
# Quick, count to ten!
for i in range(10):
    # (but not *too* quick)
    time.sleep(0.5)
    print i
~~~

### An h3 header ###

Here's a link to [a website](http://foo.bar), to a [local
doc](local-doc.html), and to a [section heading in the current
doc](#an-h2-header). Here's a footnote [^1].

[^1]: Footnote text goes here.

Tables can look like this:

size  material      color
----  ------------  ------------
9     leather       brown
10    hemp canvas   natural
11    glass         transparent

Table: Shoes, their sizes, and what they're made of

(The above is the caption for the table.) Pandoc also supports
multi-line tables:

--------  -----------------------
keyword   text
--------  -----------------------
red       Sunsets, apples, and
          other red or reddish
          things.

green     Leaves, grass, frogs
          and other things it's
          not easy being.
--------  -----------------------

A horizontal rule follows.

***

Here's a definition list:

apples
  : Good for making applesauce.
oranges
  : Citrus!
tomatoes
  : There's no "e" in tomatoe.

Again, text is indented 4 spaces. (Put a blank line between each
term/definition pair to spread things out more.)

Here's a "line block":

| Line one
|   Line too
| Line tree

and images can be specified like so:

![example image](example-image.jpg "An exemplary image")

Inline math equations go in like so: $\omega = d\phi / dt$. Display
math should get its own line and be put in in double-dollarsigns:

$$I = \int \rho R^{2} dV$$

And note that you can backslash-escape any punctuation characters
which you wish to be displayed literally, ex.: \`foo\`, \*bar\*, etc.

  </div>
  
  <select name="format" id="format">
    <option value="latex">latex - ugly but useful</option>
    <option value="html">html - useful but ugly</option>
    <option value="pdf">pdf - useful but ugly</option>
  </select>
  <button id='render'>Render and blow my mind</button>

  
  <h3>Your output whut whut</h3>
  <div id='result' class='ace'></div>
  <canvas id="the-canvas" style="border:1px solid black;"/>


  <script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.js'></script>
  <script src='/bower_components/ace/build/src/ace.js' type='text/javascript' charset='utf-8'></script>
  <script src='/socket.io/socket.io.js'></script>

  <script src="/bower_components/pdfjs-bower/dist/pdf.js"></script>
  <script src="/bower_components/pdfjs-bower/dist/compatibility.js"></script>
  <script>PDFJS.workerSrc = "/bower_components/pdfjs-bower/dist/pdf.worker.js";</script>
  <!-- <script src="lib/fonts.js"></script> -->
  <!-- <script src="lib/cffStandardStrings.js"></script> -->
  <!-- <script src="lib/Encodings.js"></script> -->
  <!-- <script src="lib/glyphlist.js"></script> -->


  <script>
    'use strict';
    /* global ace, io, $ */
    var editor = ace.edit('editor');
    var result = ace.edit('result');
    var _user  = {};
    var socket = io.connect();

    $('#render').click(function () {
      console.log('yoface')
      socket.emit('+++ render_document', {
        content: editor.getSession().getValue(),
        format: $('#format').val(),
        user : _user
      });
    });

    socket.on('--- render_document', function (rendered) {
      console.log(rendered);



      if (rendered.format === 'pdf') {
        PDFJS.getDocument({
          data: rendered.content
        }).then(function(pdf) {
          pdf.getPage(1).then(function(page) {
            var scale = 1.5;
            var viewport = page.getViewport(scale);

            var canvas = document.getElementById('the-canvas');
            var context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            var renderContext = {
              canvasContext: context,
              viewport: viewport
            };
            page.render(renderContext);
          });


          // you can now use *pdf* here
        }).catch(function (err) {
          console.trace(err);
        })
        // pdfDocument = new PDFDoc(new Stream(rendered.content));
        // numPages = pdfDocument.numPages;
        //document.getElementById("numPages").innerHTML = numPages.toString();
        //displayPage(pageNum);
        return;
      }

      else {
        result.getSession().setValue(rendered.content);
      }
    });

    socket.on('connect', function (skt) {});

    socket.on('user info', function (info) { _user = info; });


  
  </script>
  
</body>
</html>